<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>ê²°ì œ ë‚´ì—­ ë¦¬ìŠ¤íŠ¸</title>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="../common.js"></script>
    <script src="admin_header.js"></script>

    <link href="../style.css" rel="stylesheet"> 

    <style>
        #influencer_aprived_main{}
        #influencer_aprived_main .list{}
        #influencer_aprived_main .list > li{padding: 16px; border: 1px solid #ededed; border-radius: 10px;}
        #influencer_aprived_main .list > li + li{}
        #influencer_aprived_main .info_title{font-size: 1.6rem; font-weight: bold;}
        #influencer_aprived_main .info_list{margin-top: 8px; font-size: 1.2rem;}
        #influencer_aprived_main .info_list .title{color: #666}
        #influencer_aprived_main .info_list > li{}
        #influencer_aprived_main .info_list > li + li{margin-top: 3px;}
        #influencer_aprived_main .aprove_btn_box{margin-top: 30px; padding-top: 10px; border-top: 1px solid #ededed}
        #influencer_aprived_main .aprove_btn_box button{padding: 8px 30px; border-radius: 5px; background: #555; color: #fff;}
    </style>
</head>
<body>
    <main id="influencer_aprived_main" class="admin_main">
        <h2>ì¸í”Œë£¨ì–¸ì„œ ê°€ì… ìŠ¹ì¸</h2>

        <ul class="list">
        </ul>
    </main>

    <script>
        $.ajax({
            url: SPRING_BOOT_URL + "/zero9/admin/influencers",
            method: "GET",
            dataType: "json",
            headers: {
                Authorization: ACCESS_TOKEN
            },
            success: function(res){
                console.log(res.data.content);

                renderInfluencerList(res.data.content);
            },
            error: function(err){
                console.error("ì¸í”Œë£¨ì–¸ì„œ ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
                alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
            }
        });

        function renderInfluencerList(list) {
            const LIST_ELEMENT = $("#influencer_aprived_main .list");

            if (!list || list.length === 0) {
                LIST_ELEMENT.html("<li>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</li>");
                return;
            }

            let html = "";

            list.forEach(item => {

                // ìŠ¹ì¸ ëŒ€ê¸°ë§Œ ë³´ì—¬ì£¼ê¸° (status === false)
                if (item.status === false) {
                    html += `
                        <li>
                            <p class="info_title">íšŒì› ì •ë³´</p>
                            <ul class="info_list">
                                <li><span class="title">ì•„ì´ë””</span> : ${item.loginId}</li>
                                <li><span class="title">ì´ë©”ì¼</span> : ${item.email}</li>
                                <li><span class="title">ë‹‰ë„¤ì„</span> : ${item.nickName}</li>
                                <li><span class="title">í•¸ë“œí° ë²ˆí˜¸</span> : ${item.phone}</li>
                            </ul>

                            <div class="aprove_btn_box">
                                <button type="button" class="approve_btn" data-id="${item.id}">
                                    ìŠ¹ì¸
                                </button>
                            </div>
                        </li>
                    `;
                }
            });

            LIST_ELEMENT.html(html || "<li>ìŠ¹ì¸ ëŒ€ê¸°ìê°€ ì—†ìŠµë‹ˆë‹¤.</li>");
        }

        $(document).on("click", ".approve_btn", function(){

            if(!confirm("ê°€ì…ìŠ¹ì¸ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

            const influencerId = $(this).data("id");

            $.ajax({
                url: SPRING_BOOT_URL + "/zero9/admin/influencers/" + influencerId + "/approval",
                method: "PUT", 
                contentType: "application/json",
                dataType: "json",
                headers: {
                    Authorization: ACCESS_TOKEN
                },
                data: JSON.stringify({
                    approve: true
                }),
                success: function(res){

                    if(res.success === true){
                        alert(res.message || "ìŠ¹ì¸ ì™„ë£Œ");
                        location.reload(); // ğŸ”¥ í˜„ì¬ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                    }else{
                        alert(res.message || "ìŠ¹ì¸ ì‹¤íŒ¨");
                    }
                },
                error: function(err){
                    console.error("ì¸í”Œë£¨ì–¸ì„œ ìŠ¹ì¸ ì‹¤íŒ¨:", err);
                    alert("ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }
            });
        });
    </script>
</body>